<!DOCTYPE html>
<html>
<head>
  <title>Textile Production Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 30px;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
    }
    .container { max-width: 1400px; margin: 0 auto; }
    h1 { color: #2c3e50; margin-bottom: 10px; font-size: 32px; }
    .subtitle { color: #7f8c8d; margin-bottom: 30px; font-size: 14px; }
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
    .card-label { font-size: 13px; color: #95a5a6; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
    .kpi-value {
      font-size: 32px;
      font-weight: bold;
      color: #27ae60;
    }
    .kpi-value.danger { color: #e74c3c; }
    .ai-insight {
      background: linear-gradient(135deg, #e3f2fd 0%, #e8f5e9 100%);
      border-left: 5px solid #3498db;
    }
    .ai-insight h3 { margin-bottom: 15px; color: #2c3e50; }
    .prediction-text { color: #34495e; line-height: 1.6; margin-bottom: 15px; font-style: italic; }
    .risk-badge {
      display: inline-block;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .risk-low { background-color: #f39c12; color: white; }
    .risk-medium { background-color: #e67e22; color: white; }
    .risk-high { background-color: #e74c3c; color: white; }
    .chart-container {
      position: relative;
      height: 300px;
      margin-bottom: 30px;
    }
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .metric-box {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .metric-box h4 { color: #2c3e50; margin-bottom: 15px; font-size: 16px; }
    .metric-detail { display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #ecf0f1; }
    .metric-detail:last-child { border-bottom: none; margin-bottom: 0; }
    .metric-label { color: #7f8c8d; font-size: 13px; }
    .metric-val { color: #2c3e50; font-weight: 600; }
    .status-badge {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
    }
    .status-good { background-color: #27ae60; }
    .status-caution { background-color: #f39c12; }
    .status-alert { background-color: #e74c3c; }
    .footer { text-align: center; color: #95a5a6; font-size: 12px; margin-top: 40px; padding-top: 20px; border-top: 1px solid #ecf0f1; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìä Textile Production Cockpit</h1>
    <p class="subtitle">Real-time Manufacturing Analytics & AI-Powered Insights</p>

    <!-- KPI Cards -->
    <div class="kpi-grid">
      <div class="card">
        <p class="card-label">üéØ Yield Rate</p>
        <p class="kpi-value">94.2%</p>
      </div>
      <div class="card">
        <p class="card-label">‚è±Ô∏è On-Time Delivery</p>
        <p class="kpi-value">88.5%</p>
      </div>
      <div class="card">
        <p class="card-label">‚ö†Ô∏è Wastage Rate</p>
        <p class="kpi-value danger">5.8%</p>
      </div>
      <div class="card">
        <p class="card-label">üì¶ Fill Rate</p>
        <p class="kpi-value">91.2%</p>
      </div>
    </div>

    <!-- AI Insights -->
    <div class="card ai-insight">
      <h3>ü§ñ Kimi K2 Predictive Insight</h3>
      <p class="prediction-text" id="prediction">Loading AI analysis...</p>
      <span class="risk-badge" id="risk-level">ANALYZING</span>
    </div>

    <!-- Chart -->
    <div class="card">
      <h3 style="margin-bottom: 20px; color: #2c3e50;">üìà Production Metrics Trend (7 Days)</h3>
      <div class="chart-container">
        <canvas id="trendsChart"></canvas>
      </div>
    </div>

    <!-- Detailed Metrics -->
    <div class="metrics-grid">
      <div class="metric-box">
        <h4>Production Status</h4>
        <div class="metric-detail">
          <span><span class="status-badge status-good"></span>Loom A</span>
          <span class="metric-val">Operating</span>
        </div>
        <div class="metric-detail">
          <span><span class="status-badge status-good"></span>Loom B</span>
          <span class="metric-val">Operating</span>
        </div>
        <div class="metric-detail">
          <span><span class="status-badge status-caution"></span>Loom C</span>
          <span class="metric-val">Maintenance</span>
        </div>
      </div>

      <div class="metric-box">
        <h4>Quality Metrics</h4>
        <div class="metric-detail">
          <span class="metric-label">Defect Rate</span>
          <span class="metric-val">2.1%</span>
        </div>
        <div class="metric-detail">
          <span class="metric-label">Consistency</span>
          <span class="metric-val">96.4%</span>
        </div>
        <div class="metric-detail">
          <span class="metric-label">Thread Break Rate</span>
          <span class="metric-val">0.8%</span>
        </div>
      </div>

      <div class="metric-box">
        <h4>Shift Performance</h4>
        <div class="metric-detail">
          <span class="metric-label">Morning Shift</span>
          <span class="metric-val">96.2%</span>
        </div>
        <div class="metric-detail">
          <span class="metric-label">Evening Shift</span>
          <span class="metric-val">91.5%</span>
        </div>
        <div class="metric-detail">
          <span class="metric-label">Night Shift</span>
          <span class="metric-val">85.9%</span>
        </div>
      </div>
    </div>

    <div class="footer">
      <p>Last Updated: <span id="timestamp">Loading...</span> | Powered by Kimi K2 AI</p>
    </div>
  </div>
    <!-- Alerts Section -->
    <div class="card" style="background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%); border-left: 5px solid #ffc107;">
      <h3 style="margin-bottom: 20px; color: #856404;">üö® Active Alerts & Notifications</h3>
      <div id="alerts-container">
        <p style="color: #856404;">Loading alerts...</p>
      </div>
    </div>

    <!-- Inventory Section -->
    <div class="card">
      <h3 style="margin-bottom: 20px; color: #2c3e50;">üì¶ Inventory Status</h3>
      <div class="metrics-grid">
        <div class="metric-box">
          <h4>Material Availability</h4>
          <div class="metric-detail">
            <span class="metric-label">Raw Materials</span>
            <span class="metric-val">85.3%</span>
          </div>
          <div class="metric-detail">
            <span class="metric-label">Finished Goods</span>
            <span class="metric-val">42.7%</span>
          </div>
          <div class="metric-detail">
            <span class="metric-label">Work in Progress</span>
            <span class="metric-val">23.5%</span>
          </div>
        </div>
        <div class="metric-box">
          <h4>Stock Levels</h4>
          <div class="metric-detail">
            <span class="metric-label">Cotton Yarn</span>
            <span class="metric-val">450 kg</span>
          </div>
          <div class="metric-detail">
            <span class="metric-label">Synthetic Yarn</span>
            <span class="metric-val">320 kg</span>
          </div>
          <div class="metric-detail">
            <span class="metric-label">Dyes</span>
            <span class="metric-val">125 L ‚ö†Ô∏è</span>
          </div>
        </div>
      </div>
    </div>


  <script>
    // Fetch KPIs
    fetch('/api/kpis')
      .then(res => res.json())
      .catch(err => console.error('KPI Error:', err));

    // Fetch AI Predictions
    fetch('/api/predictive-insights')
      .then(res => res.json())
      .then(data => {
        document.getElementById('prediction').innerText = data.prediction;
        const riskEl = document.getElementById('risk-level');
        riskEl.innerText = `RISK LEVEL: ${data.risk_level.toUpperCase()}`;
        riskEl.className = `risk-badge risk-${data.risk_level.toLowerCase()}`;
      })
      .catch(err => {
        document.getElementById('prediction').innerText = 'Unable to load AI insights at this moment.';
        console.error('Prediction Error:', err);
      });

    // Create Trends Chart
    const ctx = document.getElementById('trendsChart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'],
        datasets: [
          {
            label: 'Yield %',
            data: [92.1, 92.8, 93.5, 94.0, 94.2, 93.8, 94.2],
            borderColor: '#27ae60',
            backgroundColor: 'rgba(39, 174, 96, 0.1)',
            borderWidth: 2,
            fill: true,
            tension: 0.4
          },
          {
            label: 'OTD %',
            data: [86.2, 87.1, 87.8, 88.2, 88.5, 88.3, 88.5],
            borderColor: '#3498db',
            backgroundColor: 'rgba(52, 152, 219, 0.1)',
            borderWidth: 2,
            fill: true,
            tension: 0.4
          },
          {
            label: 'Wastage %',
            data: [6.5, 6.2, 5.9, 5.8, 5.8, 5.9, 5.8],
            borderColor: '#e74c3c',
            backgroundColor: 'rgba(231, 76, 60, 0.1)',
            borderWidth: 2,
            fill: true,
            tension: 0.4
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'top',
            labels: { usePointStyle: true, padding: 15, font: { size: 12 } }
          }
        },
        scales: {
          y: {
            beginAtZero: false,
            min: 80,
            max: 100,
            ticks: { color: '#7f8c8d', font: { size: 11 } },
            grid: { color: '#ecf0f1' }
          },
          x: {
            ticks: { color: '#7f8c8d', font: { size: 11 } },
            grid: { color: '#ecf0f1' }
          }
        }
      }
    });

    // Update timestamp

    // Fetch Alerts
    fetch('/api/alerts')
      .then(res => res.json())
      .then(data => {
        const alertsDiv = document.getElementById('alerts-container');
        alertsDiv.innerHTML = '';
        data.alerts.forEach(alert => {
          const alertEl = document.createElement('div');
          alertEl.style.marginBottom = '10px';
          alertEl.style.padding = '10px';
          alertEl.style.borderRadius = '5px';
          alertEl.style.backgroundColor = alert.type === 'warning' ? '#fff3cd' : '#d1ecf1';
          alertEl.style.borderLeft = `4px solid ${alert.type === 'warning' ? '#ffc107' : '#17a2b8'}`;
          alertEl.innerHTML = `<strong>${alert.title}</strong><br><small>${alert.message}</small><br><small style="color: #666;">${alert.timestamp}</small>`;
          alertsDiv.appendChild(alertEl);
        });
      })
      .catch(err => console.error('Alerts Error:', err));
    function updateTimestamp() {
      const now = new Date();
      document.getElementById('timestamp').innerText = now.toLocaleString();
    }
    updateTimestamp();
    setInterval(updateTimestamp, 60000);
  </script>
</body>
</html>
